(function(){"use strict";var e={},n=document.head.querySelector('meta[name="api-url"]').content,a=document.head.querySelector('meta[name="mashie-url"]').content;function l(e){var t={id:e.id,date:new Date(e.acf.date),lunch:null,lunchAlternative:null,lunchGreen:null,lunchDessert:null,supper:null,supperGreen:null};return e.acf.lunchMeal&&(t.lunch={title:"Dagens lunch",color:"red",meal:e.acf.lunchMeal,more:""!=e.acf.lunchMore?e.acf.lunchMore:null,easyToChew:void 0!==e.acf.lunchEasyToChew&&e.acf.lunchEasyToChew,extraPotatoes:void 0!==e.acf.lunchExtraPotatoes&&e.acf.lunchExtraPotatoes}),e.acf.lunchAlternativeMeal&&(t.lunchAlternative={title:"Dagens alternativ",color:"blue",meal:e.acf.lunchAlternativeMeal,more:""!=e.acf.lunchAlternativeMore?e.acf.lunchAlternativeMore:null,easyToChew:void 0!==e.acf.lunchAlternativeEasyToChew&&e.acf.lunchAlternativeEasyToChew,extraPotatoes:void 0!==e.acf.lunchAlternativeExtraPotatoes&&e.acf.lunchAlternativeExtraPotatoes}),e.acf.lunchGreenMeal&&(t.lunchGreen={title:"Dagens gröna",color:"green",meal:e.acf.lunchGreenMeal,more:""!=e.acf.lunchGreenMore?e.acf.lunchGreenMore:null,easyToChew:void 0!==e.acf.lunchGreenEasyToChew&&e.acf.lunchGreenEasyToChew,extraPotatoes:void 0!==e.acf.lunchGreenExtraPotatoes&&e.acf.lunchGreenExtraPotatoes}),e.acf.lunchDessertMeal&&(t.lunchDessert={title:"Dessert",color:"black",meal:e.acf.lunchDessertMeal,more:""!=e.acf.lunchDessertMore?e.acf.lunchDessertMore:null,easyToChew:void 0!==e.acf.lunchDessertEasyToChew&&e.acf.lunchDessertEasyToChew,extraPotatoes:void 0!==e.acf.lunchDessertExtraPotatoes&&e.acf.lunchDessertExtraPotatoes}),e.acf.supperMeal&&(t.supper={title:"Kvällsmat",color:"red",meal:e.acf.supperMeal,more:""!=e.acf.supperMore?e.acf.supperMore:null,easyToChew:void 0!==e.acf.supperEasyToChew&&e.acf.supperEasyToChew,extraPotatoes:void 0!==e.acf.supperExtraPotatoes&&e.acf.supperExtraPotatoes}),e.acf.supperGreenMeal&&(t.supperGreen={title:"Kvällens gröna",color:"green",meal:e.acf.supperGreenMeal,more:""!=e.acf.supperGreenMore?e.acf.supperGreenMore:null,easyToChew:void 0!==e.acf.supperGreenEasyToChew&&e.acf.supperGreenEasyToChew,extraPotatoes:void 0!==e.acf.supperGreenExtraPotatoes&&e.acf.supperGreenExtraPotatoes}),e.acf.supperSimpleMeal&&(t.supperSimple={title:"Kvällens enkla",color:"black",meal:e.acf.supperSimpleMeal,more:""!=e.acf.supperSimpleMore?e.acf.supperSimpleMore:null,easyToChew:void 0!==e.acf.supperSimpleEasyToChew&&e.acf.supperSimpleEasyToChew,extraPotatoes:void 0!==e.acf.supperSimpleExtraPotatoes&&e.acf.supperSimpleExtraPotatoes}),t}e.extractMeal=l,e.extractMeals=function(e,t,n){var r=[];for(var a in e){var i=e[a],o=new Date(i.acf.date);(!t||dateExtension.dateString(o)>=dateExtension.dateString(t))&&(!n||dateExtension.dateString(o)<=dateExtension.dateString(n))&&r.push(l(i))}return r},e.getFood=function(e,r){var t=null;t=e.legacy?n+"/matsedel":"string"==typeof e.facility?a+"?facility="+e.facility:a,http.get(t,function(e,t){if(e)return console.error(e),void r(e);var n=JSON.parse(t);r(null,n)})},e.getActivities=function(r){http.get(n+"/aktiviteter?per_page=200",function(e,t){if(e)return console.error(e),void r(e);var n=JSON.parse(t);r(null,n)})},this.api=e}).call(this),function(){"use strict";var a=null;function t(e){(document.head||document.getElementsByTagName("head")[0]).querySelector("title").textContent=e}window.user=null,document.addEventListener("DOMContentLoaded",function(){var n=document.querySelector("#pageContent");if((a=new SpinnerRenderer(document.body)).start(),0==window.location.pathname.indexOf("/seniorlaiban/sites/activities")){t("Aktiviteter - Kungshult");var r=new URLSearchParams(window.location.search);api.getActivities(function(e,t){new ActivitiesRenderer(n,t,r.get("year"),r.get("month")).render(),a.stop()})}else if(0==window.location.pathname.indexOf("/seniorlaiban/sites/food/todaysMeals")){t("Dagens måltider - Kungshult");var e={legacy:!1,facility:"kungshult"};"legacy"==(r=new URLSearchParams(window.location.search)).get("version")&&(e.legacy=!0),"string"==typeof r.get("facility")&&(e.facility=r.get("facility")),api.getFood(e,function(e,t){new TodaysMealsRenderer(n,t,r.get("date")).render(),a.stop()})}else 0==window.location.pathname.indexOf("/seniorlaiban/sites/food/menu")&&(t("Matsedel - Kungshult"),r=new URLSearchParams(window.location.search),api.getFood(function(e,t){new FoodMenuRenderer(n,t,r.get("week"),r.get("year")).render(),a.stop()}))})}.call(this),function(){"use strict";var e={};function i(e,t,n){void 0===n&&(n=e.getFullYear());var r=new Date(n,0,1+7*(t-1)),a=r.getDay(),i=r;a<=4?i.setDate(r.getDate()-r.getDay()+1):i.setDate(r.getDate()+8-r.getDay()),e.setFullYear(i.getFullYear()),e.setMonth(i.getMonth()),e.setDate(i.getDate())}e.isSameDay=function(e,t){return e.getFullYear()==t.getFullYear()&&e.getDate()==t.getDate()&&e.getMonth()==t.getMonth()},e.getTime=function(e){return e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},e.dateString=function(e){return e.toLocaleDateString("sv-SE",{year:"numeric",month:"numeric",day:"numeric"})},e.getDaysInMonth=function(e,t){return new Date(e,t,0).getDate()},e.getWeek=function(e){var t=new Date(e);t.setHours(0,0,0),t.setDate(t.getDate()+4-(t.getDay()||7));var n=new Date(t.getFullYear(),0,1);return Math.ceil(((t-n)/864e5+1)/7)},e.setWeek=i,e.getSpan=function(e,t){var n=new Date,r=new Date(n.getFullYear()+"-"+(n.getMonth()+1)+"-"+n.getDate());i(r,e,t);var a=new Date(r);return a.setDate(a.getDate()+6),{start:r,end:a}},this.dateExtension=e}.call(this),function(){"use strict";var e={};function o(t,n,r){function e(){401!=this.status&&403!=this.status?200<=a.status&&a.status<400?n(null,this.responseText):(n({status:this.status,message:this.responseText}),console.error(this.responseText)):api.login(function(e){e?n(e):o(t,n,r)})}var a=new XMLHttpRequest;for(var i in a.addEventListener("load",e),a.addEventListener("error",e),a.upload&&r&&a.upload.addEventListener("progress",r,!1),a.open(t.method,t.url,!0),window.user&&a.setRequestHeader("Authorization","Bearer "+window.user.token),t.headers)a.setRequestHeader(i,t.headers[i]);return t.data?a.send(t.data):a.send(),a}e.req=o,e.get=function(e,t){return o({url:e,method:"get"},t)},e.postJSON=function(e,t,n){return o({url:e,method:"POST",data:JSON.stringify(t),headers:{"Content-Type":"application/json"}},n)},this.http=e}.call(this),function(){"use strict";function e(e){this.element=e,this.spinnerEl=template.get("spinner")}e.prototype.start=function(){var e=this.spinnerEl;util.removeClass(e,"fadeOut"),util.addClass(e,"fadeIn"),this.element.appendChild(e)},e.prototype.stop=function(e){var t=this.spinnerEl;util.removeClass(t,"fadeIn"),util.addClass(t,"fadeOut"),setTimeout(function(){e&&e(),util.removeNode(t)},500)},this.SpinnerRenderer=e}.call(this),function(){"use strict";var e={};e.get=function(e){var t=document.head.querySelector("#"+e+"Template").textContent;if(!t)return null;var n=document.createElement("div");return n.innerHTML=t.trim(),n.firstChild},this.template=e}.call(this),function(){"use strict";var e={},a="webkitAnimationEnd mozAnimationEnd msAnimationEnd oAnimationEnd animationend",i="webkitTransitionEnd mozTransitionEnd msTransitionEnd oTransitionEnd Transitionend";function r(e,t,n){o(e,function(e){e.setAttribute&&e.setAttribute(t,n)})}function o(e,n){!e||0===e.length&&e!=window||(e.length?Array.prototype.forEach.call(e,function(e,t){n(e)}):n(e))}function l(t,n,r,a){var i=function(e){u(t,n,i,a),r(e)};s(t,n,i,a)}function s(e,r,a,i){void 0===i&&(i=!1),o(e,function(e){var t=r.split(" ");for(var n in t)e.addEventListener(t[n],a,i)})}function u(e,r,a,i){void 0===i&&(i=!1),o(e,function(e){var t=r.split(" ");for(var n in t)e.removeEventListener(t[n],a,i)})}function c(e,r){o(e,function(e){if(e.classList){var t=r.split(" ");for(var n in t)e.classList.add(t[n])}else e.className+=" "+r})}function d(e,r){o(e,function(e){if(e.classList){var t=r.split(" ");for(var n in t)e.classList.remove(t[n])}else e.className=e.className.replace(new RegExp("(^|\\b)"+r.split(" ").join("|")+"(\\b|$)","gi")," ")})}function p(e,t){return e.classList?e.classList.contains(t):new RegExp("(^| )"+t+"( |$)","gi").test(e.cls)}function h(e,t,n,r,a){var i=document.createEvent(e);i.initEvent(n,r,a),t.dispatchEvent(i)}function f(){if(null!=window.currentLanguage)return window.currentLanguage}e.currentLanguage=f,e.translate=function(e){if(void 0===window.translations)return e;var t=f();void 0===t&&(t="en");var n=window.translations[t];void 0===n&&(console.error("language not found ",t,window.selectedLanugage),n=window.translations.en);var r=n[e];if(void 0===r)return e+"_key_not_found";for(var a in arguments)0!=a&&(r=r.replace("%s",arguments[a]));return r},e.removeChildren=function(e){if(e)for(;e.firstChild;)e.removeChild(e.firstChild)},e.createElement=function(e,t,n,r){var a,i;for(var o in t||(t={}),-1!==e.indexOf(".")&&(e=(i=e.split("."))[0],i.shift(),t.class=i.join(" ")),-1!==e.indexOf("#")&&(e=(i=e.split("#"))[0],t.id=i[1]),a=document.createElement(e),t)a.setAttribute(o,t[o]);return n&&n.appendChild(a),r&&(a.innerHTML=r),a},e.removeNode=function(e){e&&o(e,function(e){e&&e.parentNode&&e.parentNode.removeChild(e)})},e.detectCSSFeature=function(e){var t=!1,n="Webkit Moz ms O".split(" "),r=document.createElement("div"),a=null;if(e=e.toLowerCase(),void 0!==r.style[e]&&(t=!0),!1===t){a=e.charAt(0).toUpperCase()+e.substr(1);for(var i=0;i<n.length;i++)if(void 0!==r.style[n[i]+a]){t=!0;break}}return t},e.each=o,e.addAttr=r,e.removeAttr=function(e,t){o(e,function(e){e.removeAttribute&&e.removeAttribute(t)})},e.attr=function(e,t,n){if(void 0===n&&e&&void 0!==e.getAttribute)return e.getAttribute(t);r(e,t,n)},e.one=l,e.onAnimationEnd=function(e,t){l(e,a,t)},e.onTransitionEnd=function(e,t){l(e,i,t)},e.on=s,e.off=u,e.isChild=function e(t,n){return!!(t&&n&&t.parentNode)&&(t===n||t.parentNode===n||e(t.parentNode,n))},e.hasClass=p,e.stopPropagation=function(e){null!=e&&("function"==typeof e.stopPropagation?(e.stopPropagation(),e.preventDefault()):window.event&&window.event.hasOwnProperty("cancelBubble")&&(window.event.cancelBubble=!0))},e.addClass=c,e.removeClass=d,e.toggleClass=function(e,t){var n=t.split(" ");o(e,function(e){for(var t in n)p(e,n[t])?d(e,n[t]):c(e,n[t])})},e.animateCSS=function(t,n,e,r){e&&l(t,"webkitAnimationStart mozAnimationStart msAnimationStart oAnimationStart animationstart",e),l(t,a,function(e){d(t,n),r&&r(e)},!1),c(t,n)},e.transitionCSS=function(t,n,e,r){e&&l(t,"webkitTransitionStart mozTransitionStart msTransitionStart oTransitionStart Transitionstart",e),l(t,i,function(e){d(t,n),r&&r(e)}),c(t,n)},e.isObject=function(e){return e===Object(e)},e.fireEvent=h,e.fireMouseEvent=function(e,t,n,r){h("MouseEvent",e,t,n,r)},e.transform=function(e,t){o(e,function(e){e.style.transform=t,e.style.OTransform=t,e.style.msTransform=t,e.style.MozTransform=t,e.style.WebkitTransform=t})},e.lazyLoad=function(e,t,n){if(n||(n="data-image"),t){var r="url("+t+")",a=new Image;return a.onload=function(){util.each(e,function(e){e.style.backgroundImage!=r&&(e.style.backgroundImage=r,util.attr(e,n,t))})},void(a.src=t)}util.each(e,function(t){if(util.attr(t,n)){var e=new Image;e.onload=function(){var e="url("+util.attr(t,n)+")";t.style.backgroundImage!=e&&(t.style.backgroundImage=e)},e.src=util.attr(t,n)}})},e.unloadImage=function(e,t,n){n||(n="data-image"),util.each(e,function(e){e.style.backgroundImage=null,util.attr(e,n,null)})},e.guid=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},e.clone=function(e){return JSON.parse(JSON.stringify(e))},e.prepend=function(e,t){e&&t&&(e.firstChild?e.insertBefore(t,e.firstChild):e.appendChild(t))},e.after=function(e,t){e&&t&&e.parentNode&&(e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t))},e.sort=function(e,t){for(var n=[],r=e.children,a=0;a<r.length;a++)n.push(r[a]);for(n.sort(t),a=0;a<n.length;a++)e.appendChild(n[a])},this.util=e}.call(this),function(){"use strict";function o(e,t){return e.filter(function(e){return dateExtension.isSameDay(e.starts,t)})}function a(e,t,n){e=function(e){var t=[];for(var n in e){var r=e[n].acf,a={starts:new Date(r.start.replace(" ","T")),ends:r.end?new Date(r.end.replace(" ","T")):null,description:r.description.replace("&amp;","&"),cancelled:r.cancelled};a.color=0==a.starts.getDay()?"red":"black",t.push(a)}return t}(e);for(var r=[],a=1;a<=dateExtension.getDaysInMonth(t,n+1);a++){var i=o(e,new Date(t,n,a));0<i.length&&r.push(i)}return r}function e(e,t,n,r){n=n?parseInt(n):(new Date).getFullYear(),r=r?parseInt(r)-1:(new Date).getMonth(),this.year=n,this.month=r,this.data=a(t,n,r),this.element=e}e.prototype.render=function(){var e=template.get("activitiesContainer");this.element.innerHTML="";var t=new Date(this.year,this.month,1).toLocaleDateString("sv-SE",{month:"long"});e.querySelector("[t-id=pageTitle]").textContent="Aktiviteter "+t+" "+this.year;var n=e.querySelector("[t-id=activities]");for(var r in this.data)this.renderActivity(n,this.data[r]);this.element.appendChild(e)},e.prototype.renderActivity=function(e,t){var n=util.createElement("tr"),r=util.createElement("td.weekday",null,n),a=util.createElement("td.day",null,n),i=util.createElement("td",null,n),o=util.createElement("td",null,n);for(var l in t){var s=t[l];if(12<s.starts.getHours())var u=o;else u=i;0==l&&(r.style.color=s.color,a.style.color=s.color,r.textContent=s.starts.toLocaleDateString("sv-SE",{weekday:"long"}),a.textContent=s.starts.getDate()),s.ends?u.textContent=dateExtension.getTime(s.starts)+" - "+dateExtension.getTime(s.ends)+" "+s.description:u.textContent=dateExtension.getTime(s.starts)+" "+s.description,dateExtension.getWeek(s.starts)%2==0?util.addClass(n,"even"):util.addClass(n,"odd"),s.cancelled&&util.addClass(u,"cancelled")}e.appendChild(n)},this.ActivitiesRenderer=e}.call(this),function(){"use strict";function e(e,t,n){var r=function(e,t){var n=new Date;return t&&(n=new Date(t)),api.extractMeals(e,n,n)}(t,n);this.data=0<r.length?r[0]:null,this.element=e}e.prototype.render=function(){this.element.innerHTML="";var e=template.get("todaysMealsContainer"),t=this.data;if(null==t)return e.textContent="Saknar matsedel",void this.element.appendChild(e);e.querySelector("[t-id=title]").textContent=t.date.toLocaleDateString("sv-SE",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),e.querySelector("[t-id=title]").style.color="Green",e.querySelector("[t-id=title]").style.textTransform="capitalize",null!=t.lunch&&this.renderMeal(e.querySelector("[t-id=meals]"),t.lunch),null!=t.lunchAlternative&&this.renderMeal(e.querySelector("[t-id=meals]"),t.lunchAlternative),null!=t.lunchGreen&&this.renderMeal(e.querySelector("[t-id=meals]"),t.lunchGreen),null!=t.lunchDessert&&this.renderMeal(e.querySelector("[t-id=meals]"),t.lunchDessert),null!=t.supper&&this.renderMeal(e.querySelector("[t-id=meals]"),t.supper),null!=t.supperGreen&&this.renderMeal(e.querySelector("[t-id=meals]"),t.supperGreen),null!=t.supperSimple&&this.renderMeal(e.querySelector("[t-id=meals]"),t.supperSimple),this.element.appendChild(e)},e.prototype.renderMeal=function(e,t){var n=template.get("todaysMealsMeal");n.querySelector("[t-id=title]").textContent=t.title,n.querySelector("[t-id=title]").style.color=t.color,n.querySelector("[t-id=description]").textContent=t.meal,t.more&&(n.querySelector("[t-id=more]").textContent="Serveras med "+t.more),e.appendChild(n)},this.TodaysMealsRenderer=e}.call(this),function(){"use strict";function e(e,t,n,r){n||(n=dateExtension.getWeek(new Date)),r||(r=(new Date).getFullYear());var a=dateExtension.getSpan(n,r);this.data=api.extractMeals(t,a.start,a.end),this.week=n,this.year=r,this.element=e}e.prototype.render=function(){var e=template.get("foodMenuContainer");this.element.innerHTML="",(new Date).getFullYear()==this.year?e.querySelector("[t-id=title]").textContent="Matsedel vecka "+this.week:e.querySelector("[t-id=title]").textContent="Matsedel vecka "+this.week+" "+this.year;var t=!0;for(var n in this.data){var r=this.data[n];this.renderLunch(e.querySelector("[t-id=lunch]"),r),null==r.lunch&&null==r.lunchAlternative&&null==r.lunchGreen&&null==r.lunchDessert||(t=!1)}var a=!0;for(var n in this.data){r=this.data[n];if(this.renderSupper(e.querySelector("[t-id=supper]"),r),null!=r.supper||null!=r.supperGreen||null!=r.supperSimple)a=!1}t&&a?(this.element.innerHTML="",this.element.innerHTML='<div class="food-menu-empty">Saknar matsedel för denna vecka</div>'):(t?util.removeNode(e.querySelector("[t-id=lunch]")):a&&util.removeNode(e.querySelector("[t-id=supper]")),this.element.appendChild(e))},e.prototype.renderLunch=function(e,t){var n=template.get("foodMenuDay"),r=n.querySelector("[t-id=meals]");n.querySelector("[t-id=title]").textContent=t.date.toLocaleDateString("sv-SE",{weekday:"long",year:"numeric",month:"long",day:"numeric"});null!=t.lunch&&this.renderMeal(r,t.lunch),null!=t.lunchAlternative&&this.renderMeal(r,t.lunchAlternative),null!=t.lunchGreen&&this.renderMeal(r,t.lunchGreen),null!=t.lunchDessert&&this.renderMeal(r,t.lunchDessert),e.appendChild(n)},e.prototype.renderSupper=function(e,t){var n=template.get("foodMenuDay"),r=n.querySelector("[t-id=meals]");n.querySelector("[t-id=title]").textContent=t.date.toLocaleDateString("sv-SE",{weekday:"long",year:"numeric",month:"long",day:"numeric"});null!=t.supper&&this.renderMeal(r,t.supper),null!=t.supperGreen&&this.renderMeal(r,t.supperGreen),null!=t.supperSimple&&this.renderMeal(r,t.supperSimple),e.appendChild(n)},e.prototype.renderMeal=function(e,t){var n=template.get("foodMenuMeal");n.querySelector("[t-id=title]").textContent=t.title,n.querySelector("[t-id=title]").style.color=t.color,n.querySelector("[t-id=description]").textContent=t.meal,n.querySelector("[t-id=more]").textContent=t.more;var r=[];t.extraPotatoes&&r.push("P"),t.easyToChew&&r.push("**"),n.setAttribute("data-content",r.join(" ")),e.appendChild(n)},this.FoodMenuRenderer=e}.call(this);